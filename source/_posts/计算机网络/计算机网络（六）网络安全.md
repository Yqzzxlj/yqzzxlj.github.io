---
title: 计算机网络（六）网络安全
date: 2020-10-29 20:34:18
tags: 
    - 计算机网络
categories:
    - 计算机基础知识
    - 计算机网络
---
## 安全通信
1.  机密性（confidentiality） 因为窃听者可以截获报文，所以需要加密
2.  报文完整性（message integrity） 确保没有被改动
3.  端点鉴别（end-point authentication） 确定通信双方
4.  运行安全性（operational security）  


## 密码学的原则

明文（plaintext， clear text）
密文（cipher text）
密钥（key）
加密算法（encryption algorithm）
解密算法（decryption algorithm）

### 对称密钥密码体制 （symmetric）
对称性加密，也叫共享密钥密码。用相同的密钥进行加密和解密。

有很多优秀的对称加密算法。在算法上无懈可击，拥有巨大的密钥空间，基本无法暴力破解而且加密过程快速。

但是，一切对称加密算法的软肋在于密钥的配送。可以用密钥交换算法或非对称加密算法。

#### Diffie-Hellman密钥交换算法
1.  Alice 和 Bob 协商出两个数字 N 和 G 作为生成元
1.  现在 Alice 和 Bob 心中各自想一个数字出来，分别称为 A 和 B
2.  现在 Alice 将自己心里的这个数字 A 和 G 通过某些运算得出一个数 AG，然后发给 Bob；Bob 将自己心里的数 B 和 G 通过相同的运算得出一个数 BG，然后发给 Alice
3.  Alice 可以通过 BG 和自己的 A 通过某些运算得到一个数 ABG，Bob 也可以通过 AG 和自己的 B 通过某些运算得到 ABG，这个数就是 Alice 和 Bob 共有的秘密

### 公开密钥加密

公钥用于加密，私钥用于解密。（RSA）

但是非对称加密算法无法确定通信双方的身份，会遭到中间人的攻击。比如 Hack 拦截 Bob 发出的公钥，然后冒充 Bob 的身份给 Alice 发送自己的公钥，那么不知情的 Alice 就会把私密数据用 Hack 的公钥加密，Hack 可以通过私钥解密窃取。

### 报文完整性和数字签名

#### 报文完整性

密码散列函数的附加性质：找到任意两个不同的报文x和y使得`$H(x)=H(y)$`,在计算上是不可能的。

报文鉴别码：
1.  Alice生成报文m并计算散列`$H(m)$`
2.  然后Alice将`$H(m)$`附加到报文m上，生成一个扩展报文（m, H(m)),并将该扩展报文发给Bob
3.  Bob接收到一个扩展报文（m，h）并计算`$H(m)$`，如果`$H(m)=h$`,Bob会认为一切正常。

缺陷： 其他人可以生成虚假报文（m', H(m')),Bob无法发现这种行为。

为解决这种缺陷，需要鉴别密钥（authentication key），共享秘密s。

1.  Alice生成报文m, 用s级联m以生成m+s，并计算散列`$H(m+s)$`。`$H(m+s)$`称为**报文鉴别码**（Message Authentication Code，MAC）
2.  然后Alice将MAC附加到报文m上，生成一个扩展报文（m, H(m+s)),并将该扩展报文发给Bob
3.  Bob接收到一个扩展报文（m，h）并计算`$H(m+s)$`，如果`$H(m+s)=h$`,Bob会认为一切正常。


#### 数字签名

数字签名是一种在数字领域表明身份的密码技术。

用私钥加密数据，然后把加密的数据公布出去，这就是数字签名。

#### 公钥认证
证书就是公钥+签名，由第三方认证机构颁发。
证书认证的流程：
1.  Bob去可信任的认证机构正是本人真实身份，并提供自己的公钥
2.  Alice想和Bob通信时，先向认证机构请求Bob的公钥，认证机构会将一张证书（bob的公钥以及自己对其公钥的签名）发送给Alice
3.  Alice检查签名，确定该公钥确实由这家认证机构发送，中途未被篡改。
4.  Alice通过这个公钥加密数据，开始和Bob通信。

正规浏览器中都预存了正规认证机构的证书（包含其公钥），用于确认机构身份。


### HTTPS是身披SSL外壳的HTTP
当HTTP加上加密处理和认证以及完整性保护后就是HTTPS。

HTTPS并非是应用层的一种新协议。只是HTTP通信接口部分用SSL（secure socket layer）和TLS（transport layer security）协议代替。

采用了SSL后，HTTP就有了HTTPS的加密、证书、和完整性保护这些功能。

![](https://raw.githubusercontent.com/Yqzzxlj/Image-Hosting/master/HTTP%E5%92%8CHTTPS.png)


## 使用TCP连接安全：SSL
安全套接字层（Secure Socket Layer）SSL
运输层安全性（Transport Layer Security） TLS

类SSL(和SSL)具有三个阶段：握手、密钥导出和数据传输。

#### 1.握手
在握手阶段，Bob需要：
    1.  与Alice创建一条TCP连接
    2.  验证Alice是真实的Alice
    3.  发送给Alice一个主密钥（MS），Bob和Alice持用该主密钥生成SSL会话所需的所有对称密钥
    
#### 2.密钥导出
Alice和Bob用MS生成4个密钥：

+ `$E_B$`,用于从Bob发送到Alice的数据的会话加密密钥
+ `$M_B$`,用于从Bob发送到Alice的数据的会话MAC密钥
+ `$E_A$`,用于从Alice发送到Bob的数据的会话加密密钥
+ `$M_A$`,用于从Alice发送到Bob的数据的会话MAC密钥

#### 3.数据传输

用密钥传输并维护一个序号计数器。防止被人乱序或删除报文。

#### 4.SSL记录

由类型字段、版本字段、长度字段、数据字段和MAC字段组成。前三个字段不加密。

类型字段用于指出该字段是握手报文还是包含应用数据的报文，也用于关闭SSL连接。、

在接受端的SSL使用长度字段从到达的TCP字节流中提取SSL记录。

版本字段是自解释的。

![](https://raw.githubusercontent.com/Yqzzxlj/Image-Hosting/master/SSL%E8%AE%B0%E5%BD%95%E6%A0%BC%E5%BC%8F.png)


## 常见网络攻击

### 局域网ARP泛洪与欺骗

#### ARP协议
地址解析协议，根据IP地址获取MAC地址的一个网络层协议。

1. ARP首先会发起一个请求数据包，数据包的首部包含了目标主机的IP地址，然后这个数据包会在链路层进行再次包装，生成以太网数据包，最终由以太网广播给子网内的所有主机
2. 每一台主机都会接收到这个数据包，并取出标头里的IP地址，然后和自己的IP地址进行比较，如果相同就返回自己的MAC地址，如果不同就丢弃该数据包
3. ARP接收返回消息，以此确定目标机的MAC地址，与此同时，ARP还会将返回的MAC地址与对应的IP地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。

正常的通信是除非一开始mac表中没有目标主机的mac和端口，这样才进行数据广播，只要mac表中有相应的绑定关系，之后两台主机间的通信，都是由交换机直接根据mac和端口绑定进行转发，其他的主机是获取不到这两台主机之间的数据的。

#### 泛洪
主机A在自己的ARP缓存中没有找到主机B的IP地址，并且交换机中也没有主机B的信息。交换机会将数据报发送到A所在端口以外的所有端口，这就是泛洪。



#### 泛洪攻击的实现方法

泛洪攻击的目标就是想获取主机之间的通信数据。要想达到这个目的，就需要强迫交换机进行数据广播，那就要实现mac表中没有目标主机的mac和端口绑定。

通过伪造大量的未知mac地址进行通信，交换机进行不断的学习，很快mac表就会被充满，这样正常的主机的mac地址在经过老化之后，就无法再添加到mac地址表中，导致之后的数据都变成了广播。

#### 欺骗方法

然后抓取合法的计算机回复自己的mac地址，并将自己IP地址伪装成抓取到的IP地址。

ARP攻击主要在局域网中，因为ARP包不会跨网络传播。

#### 防御方法

1. 进行MAC和IP地址进行绑定
2. 杀毒软件开启arp防火墙

### DDoS（Distributed Denial of Service）
分布式拒绝服务。攻击者利用多台计算机对目标网站在较短的时间内发起大量请求，大规模消耗目标网站的主机资源，让它无法正常服务。

#### 应对方法
1. 高防服务器
2. 黑名单
3. DDos清洗，发现一直占用资源，清洗
4. CDN加速，隐藏真实IP，分流到各个节点。

### TCP SYN Flood （SYN 泛洪攻击）
经典的DOS攻击
攻击者发送大量的TCP SYN报文段，而不完成第三次握手的步骤。随着这种SYN报文段的到来，服务器不断为这些半开连接分配资源，导致服务器的连接资源被消耗殆尽。。

#### 防御系统
SYN cookie
1.  当服务器接收到SYN报文段时，不分配资源。生成TCP序列号，与源和目的IP地址与端口号以及仅服务器知道的散列函数有关。称为cookie，但服务器不记忆该cookie和其他状态信息，发送回源主机。
2.  收到ACK报文段后，通过cookie与ACK验证是否合法，生成连接。

### XSS（Cross Site Scripting） 跨站脚本攻击  
是最普遍的Web应用安全漏洞。这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。

HTML是一种超文本标记语言，通过将一些字符特殊地对待来区别文本和标记，例如，小于符号（<）被看作是HTML标签的开始，<title>与</title>之间的字符是页面的标题等等。当动态页面中插入的内容含有这些特殊字符（如<）时，用户浏览器会将其误认为是插入了HTML标签，当这些HTML标签引入了一段JavaScript脚本时，这些脚本程序就将会在用户浏览器中执行。所以，当这些特殊字符不能被动态页面检查或检查出现失误时，就将会产生XSS漏洞。

常用的XSS攻击手段和目的有：
1. 盗用cookie，获取敏感信息。
2. 利用植入Flash，通过crossdomain权限设置进一步获取更高权限；或者利用Java等得到类似的操作。
3. 利用iframe、frame、XMLHttpRequest或上述Flash等方式，以（被攻击）用户的身份执行一些管理动作，或执行一些一般的如发微博、加好友、发私信等操作。
4. 利用可被攻击的域受到其他域信任的特点，以受信任来源的身份请求一些平时不允许的操作，如进行不当的投票活动。
5. 在访问量极大的一些页面上的XSS可以攻击一些小型网站，实现DDoS攻击的效果。
6. 利用虚假输入表单骗取用户个人信息
7. 显示伪造的文章或图片

### SQL注入攻击
### OS注入攻击


## Web的攻击技术

![](https://raw.githubusercontent.com/Yqzzxlj/Image-Hosting/master/%E9%92%88%E5%AF%B9Web%E7%9A%84%E6%94%BB%E5%87%BB%E6%8A%80%E6%9C%AF.png)
![](https://raw.githubusercontent.com/Yqzzxlj/Image-Hosting/master/%E5%9B%A0%E8%BE%93%E5%87%BA%E5%80%BC%E8%BD%AC%E7%A7%BB%E4%B8%8D%E5%AE%8C%E5%85%A8%E5%BC%95%E5%8F%91%E7%9A%84%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E.png)
![](https://raw.githubusercontent.com/Yqzzxlj/Image-Hosting/master/%E5%85%B6%E4%BB%96%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E.png)