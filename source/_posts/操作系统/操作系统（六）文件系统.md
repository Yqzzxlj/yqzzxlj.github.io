---
title: 操作系统（六）文件系统
date: 2020-10-29 21:17:05
tags: 
    - 操作系统
categories:
    - 计算机基础知识
    - 操作系统
---
## 文件系统基础

### 文件

#### 定义
+ 实质上是一个抽象数据类型，也就是一种数据结构。
+ 以计算机硬盘为载体存储在计算机上的信息集合。
+ 在用户进行的输入、输出中，以文件为基本单位

#### 文件系统
+ 操作系统中负责管理和存储文件信息的软件机构。

### 逻辑结构

#### 无结构文件（流式文件）
将数据按顺序组织成记录并积累保存，以字节为单位。
#### 有结构文件（记录式文件）
1. 顺序文件
    + 串结构：记录之间的顺序与关键字无关
    + 顺序结构：记录之间的顺序与关键字有关
2. 索引文件：为变长文件建立索引表，提高查找速度
3. 索引顺序文件：顺序文件和索引文件的结合。
4. 直接文件（散列文件）：通过hash函数直接决定记录地址

### 目录结构
1. 单级：全部文件都放在一个目录下
2. 两级：在目录下分出用户目录
3. 多级：将两级结构加以推广，采用树形结构
4. **无环图**：在树形结构上加入有向边，便于共享

### 文件共享

+ 基于索引节点（硬连接）：共享文件指向同一个索引节点
+ 基于符号链（软连接）：保存共享文件的路径名。


### 文件保护

+ 口令保护：通过口令访问文件
+ 加密保护：对文件进行加密处理
+ **访问控制**：根据访问者的身份进行限制


## 文件系统实现
文件系统存储在磁盘中，大部分的磁盘能够划分处一到多个分区，叫做磁盘分区。每个分区都有独立的文件系统，每块分区的文件系统可以不同。磁盘的0号分区称为主引导记录（Master Boot Record，MBR），用来引导计算机。在MBR的结尾是分区表。每个分区表给出每个分区又开始到结束的地址。

![](https://raw.githubusercontent.com/Yqzzxlj/Image-Hosting/master/%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA%E5%B8%83%E5%B1%80.png)

#### 引导块（boot block）
MBR做的第一件事就是确定活动分区，读入它的第一个块，称为引导块并执行。引导块中的程序将加载分区中的操作系统。
+ 为了一致性，每个分区都会从引导块开始，即使引导块不包含操作系统
+ 引导块占据文件系统的前4096个字节，从磁盘上的字节偏移量0开始
+ 引导块可用于启动操作系统

> 在计算机中，引导就是启动计算机的过程。开机后，CPU还不能执行指令，因为此时没有软件在主存中，所以一些软件必须先被加载到内存中。然后才能让CPU开始执行。

#### 超级块（super block）
4096字节，包含文件系统的所有关键参数
+ 文件系统的大小
+ 文件系统中的数据块数
+ 指示文件系统状态的标志
+ 分配组大小

#### 空闲空间块
文件系统中的空闲块

#### 碎片（fragment）
也叫片段。零散的单个数据称为片段。

#### inode（index node）
索引节点。每个文件有一个inode。
inode主要包括一下信息：
+ 模式/权限（保护）
+ 所有者ID
+ 组ID
+ 文件大小
+ 文件的硬链接数
+ 上次访问时间
+ 最后修改时间
+ inode上次修改时间

文件分为两部分，索引节点和块。
![](https://raw.githubusercontent.com/Yqzzxlj/Image-Hosting/master/inode%E7%BB%93%E6%9E%84.png)



### 目录实现
1. 线性列表
    + 无序：查找文件较慢，新建文件较快
    + 有序：查找文件较快，新建文件较慢
2. 哈希表：查找、新建速度都快，要处理冲突

### 文件实现
1. 连续分配：在磁盘上连续存放文件
2. 链接分配
    + 隐式：采用类似链表的结构
    + 显式：把隐式文件中的指针单独抽离出来。
3. 索引分配：每个文件所有的盘块号都集中存放，建立索引表

### 存储空间管理
1. 空闲法：把所有空闲块组织成表
2. 空闲链表法：把所有空闲块组织成链表
3. 位视图：利用二进制的每位记录空闲块
4. 成组链接：空闲表和空闲链表的结合，适合大的文件系统

## 磁盘组织与管理