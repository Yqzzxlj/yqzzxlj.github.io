---
title: 操作系统（一）操作系统概述
date: 2020-10-29 20:59:18
tags: 
    - 操作系统
categories:
    - 计算机基础知识
    - 操作系统
---

### 操作系统

操作系统是计算机系统中最基本的系统**软件**
1. 管理分配资源，组织调度计算机的工作（由上向下看）
    1. 处理机管理（进程管理）
    2. 存储器管理（内存）
    3. 文件管理（文件系统）
    4. 设备管理（I/O）
2. 为用户和其他软件提供接口和环境。
    1. 命令接口：用户利用这些命令来组织和控制作业的运行
        + 交互式命令接口（联机）
        + 批处理命令接口（脱机）
    2. 程序接口：系统调用，请求操作系统服务。

### 操作系统的特征

1. 并发： 两个或多个事件在同一时间间隔内发生。通过分时实现。
2. 共享： 指系统中的资源可供内存中多个并发的进程共同使用。
    + 互斥共享方式
    + 同时访问方式
3. 虚拟： 把一个物理上的实体变为若干个逻辑上的对应物。
    + 虚拟处理器（时分复用）
    + 虚拟存储器（空分服用）
    + 虚拟设备
    
4. 异步：并发执行时，由于资源有限，进程的执行不是一贯到底而是走走停停，以不可预知的速度向前推进。


### 操作系统的运行机制
计算机有两种运行模式：内核态（管态）和用户态（目态）
+ 在内核态模式中，操作系统具有对所有硬件的完全访问权，可以执行机器能够运行的任何指令。
+ 其余部分运行在用户态下，只使用了机器指令中的一个子集，特别的，“管理程序”要执行的特权指令不允许在用户态中的程序使用。如I/O指令、置中断指令等影响机器控制的指令。

### 内核态指令实际上包括系统调用类指令和一些针对时钟、中断和原语的操作指令。

1. **时钟管理**：计时、时钟中断管理实现进程切换
2. **中断机制**：只有一小部分功能属于内核，负责保护和恢复中断现场的信息，转移控制权到相关的处理程序。减少终端的处理时间，提高系统并行处理能力。
3. **原语**：
    + 处于操作系统的最底层，是最接近硬件的部分
    + 操作不可中断（关闭中断，让其所有动作执行完在打开中断）
    + 运行时间较短且调用频繁。
4. **系统控制的数据结构及处理**：
    + 进程管理：进程状态管理、进程调度和分派、创建与撤销进程控制块
    + 存储器管理： 存储器的空间分配和回收、内存信息保护程序、代码对换程序等
    + 设备管理：缓冲区管理、设备分配和回收等

### 中断和异常
当中断或异常发生时，运行用户态的CPU会立即进入和心态。（通过硬件置位实现）

+ **中断**，外中断，来自CPU执行指令以外的事件的发生。（外设请求、人为干预）
+ **异常**，内中断，源自CPU执行指令内部的事件。（指令中断、硬件故障、软件中断）

### 系统调用
系统调用运行在系统的内核态。指用户在程序中调用操作系统所提供的一些子功能，可以被看作特殊的公共子程序，

按功能可以分为用于设备管理、文件管理、进程控制、进程通信、内存管理等。

为了获取操作系统的服务，用户程序必须使用系统调用，系统调用会转换为内核态并且调用操作系统。TRAP指令用于把用户态切换为内核态并启用操作系统。

### 操作系统结构
+ 大内核：操作系统的主要功能模块都作为一个紧密联系的整体运行在和心态，为应用提供高性能的系统服务。但随着体系结构和应用需求的发展，需要操作系统提供的服务越来越多，接口越来越复杂，设计规模急剧增长。
+ 微内核： 
    1. 将内核中最基本的功能保留在内核，将不需要在核心态执行的功能移到用户态执行，降低内核的设计复杂性。
    2. 被移出的代码根据分层的原则被划分为若干服务程序，执行相互独立，交互借助于微内核进行通信。
    3. 微内核结构有效的分离了内核与服务、服务与服务，使得接口更加清晰，维护代价大大降低，各部分可以独立的优化和演进，从而保证操作系统的可靠性。
    3. 客户服务器模式：将进行划分为两类，服务器用来提供服务，客户端使用这些服务。

-----------------

### CPU （Central Processing Unit）

+ CPU从系统的RAM中提取指令，然后解码该指令的实际内容，然后由CPU的相关部分执行该指令（提取、解码和执行）
+ CPU从功能上看主要由两部分构成
    1. 控制单元： 从内存中提取指令并解码执行
    2. 算数逻辑单元（ALU）： 处理算数和逻辑运算
+ 内部结构：
    1. 寄存器：中央处理器内的组成部分。用来暂存指令、数据和地址。可以将其看作是内存的一中，根据种类的不同，一个CPU内部会有20-100个寄存器。

    2. 控制器：负责把内存上的指令、数据读入寄存器，并根据指令的结果控制计算机
    3. 运算器： 负责运算从内存中读入寄存器的数据
    4. 时钟：负责发出CPU开始计时的时钟信号

|寄存器|功能|
|:--:|:--:|
|累加寄存器|存储运行的数据和运算后的数据|
|标志寄存器|用于反应处理器的状态和运算结果的某些特征以及控制指令的执行|
|程序计数器|程序计数器是用于存放下一条指令所在单元的地址的地方|
|基址寄存器|存储数据内存的起始位置|
|变址寄存器|存储基址寄存器的相对地址|
|通用寄存器|存储任意数据|
|指令寄存器|储存正在被运行的指令，CPU内部使用，程序员无法对该寄存器进行读写|
|栈寄存器|存储栈区域的起始位置|

+ CPU指令执行过程
    1. 取指令
    2. 指令译码
    3. 执行指令
    4. 访问取数
    5. 结果写回

### 内存

+ 程序与CPU进行沟通的桥梁。计算机中所有程序的运行都是在内存中进行的。
+ 又称为主存，作用是存放CPU中的运算数据，以及与硬盘等外部存储设备交换的数据
+ 只要计算机在运行中，CPU就会把需要运算的数据调到主存中进行运算，当运算完成后CPU再将结构传送回来

+ 内存的内部是有各种IC（Integrated Circuit，集成电路）电路组成的，它的种类很庞大，但是主要分为三种存储器：
    1. 随机存储器（RAM）：内存中最重要的一种，表示既可以从中读取数据，也可以写入数据。当机器关闭时，内存中的信息会丢失。
    2. 只读存储器（ROM）：ROM一般只能用于数据的读取，不能写入数据，但是当机器停电时，数据不会丢失
    3. 高速缓存（Cache）：分为一级缓存（L1 Cache）、二级缓存（L2 Cache）、三级缓存（L3 Cache），它位于内存和CPU之间，是一个读写速度比内存更快的存储器。当CPU向内存写入数据时，这些数据会被写入高速缓存中，需要读取数据时，会直接从高速缓存中读取。如果需要的数据在Cache中没有，会再去读取内存中的数据

### 磁盘

+ 磁盘中存储的程序必须加载到内存中才能运行，在磁盘中保存的程序是无法直接运行的。这是因为负责解析和运行程序内容的CPU是需要通过程序计数器来指定内存地址从而读出程序指令的。

+ 磁盘缓存和虚拟内存


### BIOS和引导

程序的运行环境，存在着名为BIOS（Basic Input/Output System）的系统。BIOS存储在ROM中，是预先内置在计算机主机内部的程序。BIOS除了键盘、磁盘和显卡等基本控制外，还有引导程序的功能，引导程序是存储在启动驱动器启示区域的小程序。

电脑开机后，BIOS会确认硬件是否正常运行，没有异常的话会直接启动引导程序。引导程序的功能是吧在硬盘等记录的OS加载到内存中运行。虽然启动应用是OS的功能，但是OS不能启动自己，是通过引导程序启动的。

### DMA（Direct Memory Access）
DMA是指在不通过CPU的情况下，外围设备直接和主存进行数据传输。通过DMA大量数据可以在短时间内实现传输，因为CPU作为中介的事件被节省了。
